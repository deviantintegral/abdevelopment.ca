<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">


<!-- Mirrored from www.abdevelopment.ca/blog/running-microsofts-ie-application-compatibility-images-virtualbox?page=0%2C7 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 Mar 2017 18:40:01 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>Running Microsoft&#039;s IE Application Compatibility Images in VirtualBox | Andrew Berry Development</title>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="shortcut icon" href="../../sites/all/themes/portfolio/favicon/index.ico" type="image/x-icon" />
<link rel="alternate" type="application/rss+xml" title="Recent Story Comments" href="feed/" />
  <link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/codefilter/codefilter/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/aggregator/aggregator/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/node/node/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/system/defaults/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/system/system/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/system/system-menus/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/user/user/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/cck/theme/content-module/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/date/date/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/date/date_popup/themes/datepicker/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/date/date_popup/themes/jquery.timeentry/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/img_assist/img_assist/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/lightbox2/css/lightbox/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/mollom/mollom/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/cck/modules/fieldgroup/fieldgroup/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/modules/views/css/views/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../modules/comment/comment/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/html-elements/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/zen/zen/tabs/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/zen/zen/messages/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/zen/zen/block-editing/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/zen/zen/wireframes/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/layout/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/portfolio/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/style/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/content-field-field_project_features/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/view-nodequeue-1/index.css?e" />
<link type="text/css" rel="stylesheet" media="all" href="../../sites/all/themes/portfolio/view-projects/index.css?e" />
<link type="text/css" rel="stylesheet" media="print" href="../../sites/all/themes/portfolio/print/index.css?e" />
<!--[if IE]>
<link type="text/css" rel="stylesheet" media="all" href="/sites/all/themes/zen/zen/ie.css?e" />
<![endif]-->
  <!--[if IE]>
          <link rel="stylesheet" href="//ie.css" type="text/css">
      <![endif]-->
  <script type="text/javascript" src="../../misc/jquery/index.js?e"></script>
<script type="text/javascript" src="../../misc/drupal/index.js?e"></script>
<script type="text/javascript" src="../../sites/all/modules/img_assist/img_assist/index.js?e"></script>
<script type="text/javascript" src="../../sites/all/modules/lightbox2/js/auto_image_handling/index.js?e"></script>
<script type="text/javascript" src="../../sites/all/modules/lightbox2/js/lightbox/index.js?e"></script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
jQuery.extend(Drupal.settings, {"basePath":"\/","lightbox2":{"rtl":0,"file_path":"\/(\\w\\w\/)system\/files","default_image":"\/sites\/all\/modules\/lightbox2\/images\/brokenimage.jpg","border_size":10,"font_color":"000","box_color":"fff","top_position":"","overlay_opacity":"0.8","overlay_color":"000","disable_close_click":1,"resize_sequence":0,"resize_speed":200,"fade_in_speed":400,"slide_down_speed":600,"use_alt_layout":0,"disable_resize":0,"disable_zoom":0,"force_show_nav":0,"show_caption":true,"loop_items":0,"node_link_text":"View Image Details","node_link_target":0,"image_count":"Image !current of !total","video_count":"Video !current of !total","page_count":"Page !current of !total","lite_press_x_close":"press \u003ca href=\"#\" onclick=\"hideLightbox(); return FALSE;\"\u003e\u003ckbd\u003ex\u003c\/kbd\u003e\u003c\/a\u003e to close","download_link_text":"","enable_login":false,"enable_contact":false,"keys_close":"c x 27","keys_previous":"p 37","keys_next":"n 39","keys_zoom":"z","keys_play_pause":"32","display_image_size":"preview","image_node_sizes":"(\\.thumbnail)","trigger_lightbox_classes":"img.thumbnail, img.image-thumbnail","trigger_lightbox_group_classes":"","trigger_slideshow_classes":"","trigger_lightframe_classes":"","trigger_lightframe_group_classes":"","custom_class_handler":0,"custom_trigger_classes":"","disable_for_gallery_lists":1,"disable_for_acidfree_gallery_lists":true,"enable_acidfree_videos":true,"slideshow_interval":5000,"slideshow_automatic_start":true,"slideshow_automatic_exit":true,"show_play_pause":true,"pause_on_next_click":false,"pause_on_previous_click":true,"loop_slides":false,"iframe_width":600,"iframe_height":400,"iframe_border":1,"enable_video":0}});
//--><!]]>
</script>
<script type="text/javascript">
<!--//--><![CDATA[//><!--
var BASE_URL = "../../";
//--><!]]>
</script>
  <script type="text/javascript" src="../../sites/all/themes/portfolio/js/fix-ie/index.js"></script>
</head>

<body class="not-front not-logged-in node-type-story one-sidebar sidebar-left page-blog-running-microsofts-ie-application-compatibility-images-virtualbox section-blog">

  <div id="page"><div id="page-inner">

    <a name="top" id="navigation-top"></a>

    <div id="header"><div id="header-inner" class="clear-block">

              <div id="logo-title">

          
                                  <div id='site-name'>
              <a href="../../" title="Home" rel="home">
                <strong>Andrew Berry Development</strong>
              </a>
            </div>
          
          
        </div> <!-- /#logo-title -->
      
      
    </div></div> <!-- /#header-inner, /#header -->

    <div id="main"><div id="main-inner" class="clear-block with-navbar">

      <div id="content"><div id="content-inner">

        
        
                  <div id="content-header">
            <div class="breadcrumb"><a href="../../">Home</a></div>                          <h1 class="title">Running Microsoft&#039;s IE Application Compatibility Images in VirtualBox</h1>
                                              </div> <!-- /#content-header -->
        
        <div id="content-area">
          <div class="node " id="node-45"><div class="node-inner">

  
  
  
      <div class="submitted">
      Submitted by andrew on Fri, 08/22/2008 - 14:46    </div>
  
      <div class="taxonomy"> in <ul class="links inline"><li class="taxonomy_term_22 first"><a href="../../category/tags/virtualbox/" rel="tag" title="">virtualbox</a></li>
<li class="taxonomy_term_8 last"><a href="../../category/tags/web-development/" rel="tag" title="">web development</a></li>
</ul></div>
  
  <div class="content">
    <p><strong>Update:</strong> Unfortunately, as of the September 2009 release, the VPC images from Microsoft have been changed and are now a bit more picky about activation. <strong>When you follow this procedure, the images will now fail activation</strong>. I've left this page up so that the procedure can be tried on future releases of the images.</p>
<p>Virtualbox is a virtualization product produced by Sun. Available for Windows, Linux, OS X, and Solaris, it not only is fast and full of features, but free! Most of the product is available under the GPL. Some additional features, such as USB and Remote Desktop support, are available free of charge for personal and small-scale commercial use.</p>
<p>Unfortunately, Virtualbox doesn't come with a robust set of tools to convert disk images. While you can convert images between Virtualbox (VDI) and VMWare (VMDK), as well as from straight raw disk images, you can't easily convert images from Microsoft's VirtualPC format. This is an issue when you want to use Microsoft's free VPC images for testing various versions of Internet Explorer. Luckily, with a little bit of help from QEMU, it's possible to convert these images into something usable, all without needing a copy of Windows installed to bootstrap everything.</p>
<h3>Download VirtualPC Images</h3>
<p>Download the VirtualPC images you require from the <a href="http://www.microsoft.com/en-us/download/details.aspx?id=11575">Internet Explorer Application Compatibility VPC Image</a> page.</p>
<h3>Extract Cabinet or RAR archives</h3>
<p>Depending on the image you downloaded, you either have a single cabinet file, or a multi-part RAR archive. The archives are wrapped in self-extracting executables, but most unarchivers can automatically skip the executable part. In this case, I'm using unrar and <a href="https://www.cabextract.org.uk/">cabextract</a> from <a href="https://www.macports.org/">MacPorts</a>; on Linux, the same utilities will be available easily within your package manager. If the archive contains multiple parts, be sure each one is in the same directory. On Windows, you can just run the executables directly.</p>
<p>For a RAR archive:<br />
<code>$ unrar x IE7-VIS1.exe</code></p>
<p>Or, for a MS Cabinet:<br />
<code>$ cabextract IE8B1-XPSP2_VPC.EXE</code></p>
<p>After running these commands, there should be a large VHD file in the same directory.</p>
<h3>Obtain qemu-image</h3>
<p>If you are using Linux, obtaining QEMU should be easy. Either install it with your distribution's package manager, or <a href="http://bellard.org/qemu/">download the source</a> and compile it manually. All we need is the <code>qemu-image</code> program, so we can convert the VPC image to a VMDK or raw disk image. In this example, I convert to a raw disk image. If you don't need snapshots or other similar features, and are short on disk space, you can convert to a VMDK image. The generated VMDK will be 'sparse', meaning that only sectors with data consume space, whereas a raw image will eventually be equal to the capacity of the virtual drive (though it can be shrunk down after converting to a VDI). This is very helpful for the images Microsoft provides as while they are only a few gigs for each image, the actual disk size is set to 16 gigabytes for XP, and 64 for Vista, which is quite significant on most laptop drives.</p>
<p>If you are using OS X, it's a little more complicated. Unfortunately, gcc 3.3 is required to build QEMU normally. Only gcc 4.0 and greater are supported on Intel Macs, so you can't just download the source and run <code>./configure &amp;& make qemu-image</code>.  Luckily, the <a href="http://www.kju-app.org/">Q project</a> has precompiled binaries, and includes qemu-image. You don't need to install all of Q; you can just browse the "Q" application bundle and copy <code>Contents/MacOS/qemu-image</code> to <code>/usr/local/bin</code>.</p>
<p>For Windows, you may as well just use VPC itself, since it's a free download from Microsoft. If you don't want to deal with it's poor performance, you can download Windows binaries for QEMU, or use VMWare's free image converter.</p>
<p>To convert to a raw disk image, use the following command. If you get strange errors such as "qemu-img: error while writing", try setting the destination to a disk with lots of free space. While my internal drive should have been able to handle the conversion, I was only able to get a successful conversion by writing the converted image to a network file server.</p>
<p><code>$ qemu-img convert -f vpc -O raw &lt;path to VPC file&gt; &lt;path to destination raw disk image&gt;</code></p>
<p>To convert to a VMDK, use:</p>
<p><code>$ qemu-img convert -f vpc -O vmdk &lt;path to VPC file&gt; &lt;path to destination VMDK image&gt;</code></p>
<p>There are also patches floating around on the qemu mailing lists adding support directly for VDI images, skipping this intermediate conversion step, so hopefully in the future qemu-img will be able to convert directly from a VHD to a VDI.</p>
<p>If you created raw disk images, now they need to be converted to VDI's using <code>vboxmanage</code>. Note that on OS X, the commands use upper case titles, so instead run <code>VBoxManage</code>. For example, for the Vista image, I ran the following command:</p>
<p><code>$ vboxmanage convertdd Vista\ Business\ with\ IE7.raw Vista\ Business\ with\ IE7.vdi</code></p>
<p>Finally, shrink the resulting VDI back down to a sparse image. Note that you may have to specify the full path to the file if it's not registered with VirtualBox's disk manager.</p>
<p><code>$ vboxmanage modifyvdi Vista\ Business\ with\ IE7.vdi compact</code></p>
<h3>Running the Virtual Machine</h3>
<p>Now that you have created a VDI or VMDK disk image, it can be added to VirtualBox's disk manager and used like any other disk. I highly recommend creating a snapshot <strong>before</strong> booting the VM for the first time. On first boot, the VM will redetect some of the hardware, and may require a Windows XP or Vista disk for drivers. Be sure to install the Guest tools as well to improve performance and OS integration.</p>
<h3>XP SP3 and Vista Caveats</h3>
<h4>Service Pack 3</h4>
<p>If you are using the older XP SP2 images, <strong>snapshot your VM if you intend to upgrade to SP3</strong>. While normal XP installations in VirtualBox work fine with SP3, upgrading a converted VM has lead to a blue screen on boot for me every time. Hopefully the next version of these images will be based on SP3 instead.</p>
<p>Microsoft recently updated the provided images to include SP3. This brings an extra few steps for setting up each VM. If you simply boot the images as is, it's likely you'll get <a href="https://www.virtualbox.org/ticket/420">DRIVER_UNLOADED_WITHOUT_CANCELLING_PENDING_OPERATIONS</a> in a BSOD. Luckily, this is a <a href="https://blogs.msdn.microsoft.com/virtual_pc_guy/2005/10/25/problems-with-intelppm-sys-and-processr-sys-under-virtual-pc-virtual-server/">known problem</a> with Windows XP, and can be dealt with through a simple registry hack by booting into safe mode. Follow the instructions in the linked article, or if you would rather use the command line, run:</p>
<p><code>sc config Processor start= disabled</code></p>
<p>The new SP3 images also ask for updated power management drivers on boot (cmbatt.sys, battc.sys, and compbat.sys). As the VM has been stripped of the SP3 installation files to save space, they need to be supplied from an SP3 cabinet file. The developers who put together these images were a step ahead; a CAB viewer is built into Windows Explorer, so simply mount a CD or network drive with the appropriate files and add them in. Otherwise, just click "cancel" to the two dialog boxes on every restart.</p>
<h4>Windows Vista</h4>
<p>The Vista images seem to be problematic to convert and boot properly. Sometimes they will boot with a blue screen error "0x0000008E", which can indicate disk corruption issues. Usually a reboot will fix the issue. In my experience, once booted successfully, a Vista image will remain stable.</p>
<div class="field field-type-link field-field-links">
    <div class="field-items">
                  <div class="field-item">
                                  <div class="field-label-inline-first">
                    Related Links:&nbsp;</div>
                                <a href="http://www.microsoft.com/en-us/download/details.aspx?id=11575">Internet Explorer Application Compatibility VPC Image</a>              </div>
                    <div class="field-item">
                                  <div class="field-label-inline">
                    Related Links:&nbsp;</div>
                                <a href="https://www.virtualbox.org/">VirtualBox</a>              </div>
                    <div class="field-item">
                                  <div class="field-label-inline">
                    Related Links:&nbsp;</div>
                                <a href="http://www.kju-app.org/">Q (Qemu for OS X)</a>              </div>
                    <div class="field-item">
                                  <div class="field-label-inline">
                    Related Links:&nbsp;</div>
                                <a href="http://bellard.org/qemu/">QEMU</a>              </div>
        </div>
</div>
  </div>

      <div class="links">
      <ul class="links inline"><li class="comment_forbidden first last"></li>
</ul>    </div>
  
</div></div> <!-- /node-inner, /node -->
        </div>

        
        
      </div></div> <!-- /#content-inner, /#content -->

              <div id="navbar"><div id="navbar-inner" class="region region-navbar">

          <a name="navigation" id="navigation"></a>

          
                      <div id="primary">
              <ul class="links"><li class="menu-283 first"><a href="../../home/" title="">Home</a></li>
<li class="menu-238"><a href="../../projects/" title="">Projects</a></li>
<li class="menu-239"><a href="../../resume/" title="Resumé">Resumé</a></li>
<li class="menu-279"><a href="../../services/" title="Services">Services</a></li>
<li class="menu-307 last"><a href="../../projects/free-software/" title="">Free Software</a></li>
</ul>            </div> <!-- /#primary -->
          
          
          
        </div></div> <!-- /#navbar-inner, /#navbar -->
      
              <div id="sidebar-left"><div id="sidebar-left-inner" class="region region-left">
          <div id="block-views-blog-block_1" class="block "><div class="block-inner">

      <h2 class="title">
      <span class="top-left-corner">
        <span class="top-right-corner">
          Recent Articles        </span>
      </span>
    </h2>
  
  <div class="content">
    <div class="view view-blog view-id-blog view-display-id-block_1 view-dom-id-1">
    
  
  
      <div class="view-content">
      <div class="item-list">
    <ul>
          <li class="views-row views-row-1 views-row-odd views-row-first">  
  <div class="views-field-title">
                <span class="field-content"><a href="../reduce-size-vistas-winsxs-folder/">Reduce the size of Vista&#039;s WinSxS Folder</a></span>
  </div>
</li>
          <li class="views-row views-row-2 views-row-even">  
  <div class="views-field-title">
                <span class="field-content"><a href="../missing-sync-ipaq-syncing-done-right/">Missing Sync: iPAQ Syncing Done Right</a></span>
  </div>
</li>
          <li class="views-row views-row-3 views-row-odd">  
  <div class="views-field-title">
                <span class="field-content"><a href="../mobile-ie-supported-date-browser-worse-internet-explorer-6/">Mobile IE: A supported, up to date browser worse than Internet Explorer 6?</a></span>
  </div>
</li>
          <li class="views-row views-row-4 views-row-even">  
  <div class="views-field-title">
                <span class="field-content"><a href="../windows-mobile-wireless-and-bluetooth-configuration/">Windows Mobile: Wireless and Bluetooth Configuration</a></span>
  </div>
</li>
          <li class="views-row views-row-5 views-row-odd views-row-last">  
  <div class="views-field-title">
                <span class="field-content"><a href="../reading-pdfs-windows-mobile-device/">Reading PDF&#039;s on a Windows Mobile Device</a></span>
  </div>
</li>
      </ul>
</div>    </div>
  
      <div class="item-list"><ul class="pager"><li class="pager-previous first"><a href="index0%2c6.html?page=0%2C6" class="active">‹‹</a></li>
<li class="pager-current">8 of 10</li>
<li class="pager-next last"><a href="index0%2c8.html?page=0%2C8" class="active">››</a></li>
</ul></div>  
  
      
<div class="more-link">
  <a href="../../home/">
    more  </a>
</div>
  
  
  
</div>   </div>

  
</div></div> <!-- /block-inner, /block -->
        </div></div> <!-- /#sidebar-left-inner, /#sidebar-left -->
      
      
    </div></div> <!-- /#main-inner, /#main -->

    <div id="footer"><div id="footer-inner" class="region region-footer">

      <div id="footer-message">Andrew Berry Development</div>

      
    </div></div> <!-- /#footer-inner, /#footer -->

  </div></div> <!-- /#page-inner, /#page -->

  
  
</body>

<!-- Mirrored from www.abdevelopment.ca/blog/running-microsofts-ie-application-compatibility-images-virtualbox?page=0%2C7 by HTTrack Website Copier/3.x [XR&CO'2014], Sun, 26 Mar 2017 18:40:01 GMT -->
</html>
